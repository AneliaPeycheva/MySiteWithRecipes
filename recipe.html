<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Recipe</title>
</head>
<body>
    <div class="top-nav">
        <div class="nav-container">
            <div class="top-bar">
                <div class="logo">Готви с мен</div>
                <div class="menu-holder">
                    <ul class="top-menu">           
                        <a href="index.html"><li class="menu-item" ><span>Начало</span></li> </a>                          
                        <a href="recipes.html"><li class="menu-item" ><span>Рецепти</span></li></a>
                        <a href="about.html"><li class="menu-item" ><span>За мен</span></li></a>                           
                    </ul>                               
                </div>
                <div class="nav-icon" onclick="showSideMenu()"></div> 
                <div class="side-slide">
                    <div class="close-wrapper">
                        <div class="icon close" onclick="hideSideMenu()"></div>
                    </div>
                    <ul class="vertical-menu">
                        <a href="index.html"><li class="menu-item" ><span>Начало</span></li> </a>                          
                        <a href="recipes.html"><li class="menu-item" ><span>Рецепти</span></li></a>
                        <a href="about.html"><li class="menu-item" ><span>За мен</span></li></a>     
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="content">
        <div class="section subheader" id="recipe-background">
            <div class="overlay">
                <div class="section-holder" id="recipe-title">                   
                </div>
            </div>           
        </div>
        <div class="section recipe-holder">
            <div class="section-holder">
                <div class="recipe-content-holder">
                    <div class="column two-third">
                        <div class="plain-text" id="recipe-description"></div>                                        
                        <div class="step-recipes-holder" id="pictures"></div>               
                    </div>   
                    <div class="column one-third">
                        <div class="preparation-details-holder" id="details-holder">                         
                        </div>  
                        <div class="ingredients-holder">              
                            <div class="title l white">Съставки:</div>                            
                            <hr class="line">                            
                            <ul class="ingredients-list" id="ingredients">                         
                            </ul>                             
                        </div>                        
                        <div class="latest-news-holder">
                            <div class="title l">Най-нови рецепти</div>
                            <ul class="latest-news-list" id="newest-recipes">                       
                            </ul>
                        </div>                      
                    </div> 
                </div>                             
            </div>
        </div>
        <div class="section footer">
            <div class="widgets-holder">
                <div class="section-holder">
                    <div class="column one-fourth">
                        <ul class="widget-list">
                            <li class="widget-item">
                                <span class="title s themecolor">→</span>
                                <a href=""><span class="title s gray">Сезонът на..</span></a>
                            </li>
                            <li class="widget-item">
                                <span class="title s themecolor">→</span>
                                <a href=""><span class="title s gray">Всеки ден</span></a>
                            </li>
                            <li class="widget-item">
                                <span class="title s themecolor">→</span>
                                <a href=""><span class="title s gray">Вашият уикенд</span></a>
                            </li>
                            <li class="widget-item">
                                <span class="title s themecolor">→</span>
                                <a href=""><span class="title s gray">Здравословно</span></a>
                            </li>
                            <li class="widget-item">
                                <span class="title s themecolor">→</span>
                                <a href=""><span class="title s gray">Избрано</span></a>
                            </li>
                        </ul>
                    </div>
                    <div class="column one-fourth">
                        <ul class="widget-list">
                            <li class="widget-item">
                                <span class="title s themecolor">→</span>
                                <a href=""><span class="title s gray">Вегетариански</span></a>
                            </li>
                            <li class="widget-item">
                                <span class="title s themecolor">→</span>
                                <a href=""><span class="title s gray">Риба и морски дарове</span></a>
                            </li>
                            <li class="widget-item">
                                <span class="title s themecolor">→</span>
                                <a href=""><span class="title s gray">Печива</span></a>
                            </li>
                            <li class="widget-item">
                                <span class="title s themecolor">→</span>
                                <a href=""><span class="title s gray">Десерти</span></a>
                            </li>
                            <li class="widget-item">
                                <span class="title s themecolor">→</span>
                                <a href=""><span class="title s gray">Напитки</span></a>
                            </li>
                        </ul>
                    </div>
                    <div class="column one-fourth">
                        <ul class="widget-list">
                            <li class="widget-item">
                                <span class="title s themecolor">→</span>
                                <a href=""><span class="title s gray">5 идеи</span></a>
                            </li>
                            <li class="widget-item">
                                <span class="title s themecolor">→</span>
                                <a href=""><span class="title s gray">Готово за 20мин</span></a>
                            </li>
                            <li class="widget-item">
                                <span class="title s themecolor">→</span>
                                <a href=""><span class="title s gray">Празнично меню</span></a>
                            </li>
                            <li class="widget-item">
                                <span class="title s themecolor">→</span>
                                <a href=""><span class="title s gray">Нови тенденции</span></a>
                            </li>
                            <li class="widget-item">
                                <span class="title s themecolor">→</span>
                                <a href=""><span class="title s gray">За деца</span></a>
                            </li>
                        </ul>
                    </div>
                    <div class="column one-fourth">
                        <div class="title m">Рецептитe на Ани</div>
                        <div class="plain-text gray">Пловдив
                        </div>
                        <div class="plain-text gray">
                            <br>
                            
                        </div>
                    </div>
                </div>
            </div>
            <div class="footer-copy">
                <div class="section-holder">
                    <div class="title xs gray">&copy; 2021 Muffin-Group</div>                   
                </div>                
            </div>
        </div>         
    </div>
</body>
<script>  

function showSideMenu() {
        let sidemenu = document.getElementsByClassName('side-slide')[0];
        let content = document.getElementsByClassName('content')[0];
        sidemenu.classList.add("active");
        content.classList.add("active");
    }

    function hideSideMenu() {
        let sidemenu = document.getElementsByClassName('side-slide')[0];
        let content = document.getElementsByClassName('content')[0];
        sidemenu.classList.remove("active");
        content.classList.remove("active");
    }

    function docReady(fn) {
        // see if DOM is already available
        if (document.readyState === "complete" || document.readyState === "interactive") {
            // call on next available tick
            setTimeout(fn, 1);
        } else {
            document.addEventListener("DOMContentLoaded", fn);
        }
    }  

    // DOM is loaded and ready for manipulation here  
    docReady(function() {  
        const params = new URLSearchParams(window.location.href.split("?")[1]);
      
        if (params.has('uid')) { getRecipe(params.get('uid')); }   
        
        getNewestRecepies();
    });

    function getNewestRecepies() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) { 
                let json_obj = JSON.parse(xhttp.responseText);     
                let recipes = json_obj['newest'];
                let newRecipes = document.getElementById('newest-recipes');
                let newRecipesHTML = " ";
                for (let i=0; i< recipes.length; i++) {                            
                    newRecipesHTML += '<li><a href="recipe.html?uid=' + json_obj['newest'][i]['uid'] + '"><div class="news-image img1" style="background-image:url('  + 'panel/assets/images/recipe-' + json_obj['newest'][i]['uid'] + '-image1' + '.jpeg' + ')"></div>';             
                    // newRecipesHTML += '<li><a href="recipe.html?uid=' + json_obj['newest'][i]['uid'] + '"><div class="news-image img1" style="background-image:url(' + recipes[i]['picture'] + ')"></div>';          
                    newRecipesHTML += '</a><div class="news-holder"> <a href="recipe.html?uid=' + json_obj['newest'][i]['uid'] + '"><div class="title s">' + recipes[i]['title'] + '</div></a> <hr class="line gray"> <div class="news-footer"> <div class="icon clock"></div><span class="title s gray">' + recipes[i]['data'] + '</span>';
                    newRecipesHTML += ' </div> </div></li>';
                }
               
                
                newRecipes.innerHTML = newRecipesHTML; 
                                
            }
        };
        xhttp.open("GET", "api/service.php?action=get_newest_recipes", true);
        xhttp.send();
    }




    function getRecipe(uid){
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {                   
                let json_obj = JSON.parse(xhttp.responseText);     
                let recipe = json_obj['recipe'][0];            

                let subheader = document.getElementById('recipe-background');                
                subheader.style.backgroundImage = 'url('  + 'panel/assets/images/recipe-' + recipe['uid'] + '-image1' + '.jpeg' +  ')';

                let recipeTitle = document.getElementById('recipe-title');
                recipeTitle.innerHTML = '<div class="title xl white">' + recipe['title'] + '</div>';  
                
                let recipeDescription = document.getElementById('recipe-description');
                recipeDescription.innerText = recipe['description'] ;  

                let recipeDetails = document.getElementById('details-holder');
                detailsHTML = "";
                detailsHTML += '<div class="details-item"> <div class="icon chef"></div> <div class="difficulty">' + recipe['difficulty'] +'</div> </div>';
                detailsHTML += '<div class="details-item"> <div class="icon portion"></div> <div class="portion-count">' + recipe['portion'] + '</div> </div>';
                detailsHTML += '<div class="details-item "> <div class="icon clock"></div> <div class="preparation-time"> ' + recipe['preparation'] + '</div> </div> ';
                recipeDetails.innerHTML = detailsHTML;

                let ingredients = document.getElementById('ingredients');  
                let ingredientsHTML = "";
                for (let i = 0; i < recipe['ingredients'].length; i++) {                                                                       
                    ingredientsHTML += '<li>';
                    ingredientsHTML += '<div class="icon check"></div>';
                    ingredientsHTML += '<div class="title white">' + recipe['ingredients'][i] + '</div>';
                    ingredientsHTML += '</li>';                              
                }
                ingredients.innerHTML = ingredientsHTML;

                let pictures = document.getElementById('pictures');          
                let picturesHTML = "";

                // for (let i = 0; i < recipe['pictures'].length; i++) {         
                //     picturesHTML += '<div class="column"> <div class="image-holder">  <a href="">  <div class="image" style="background-image:url(' + recipe['pictures'][i] + ')"></div>  </a></div> </div>';                         
                // }
                // pictures.innerHTML = picturesHTML;    
                for (let i = 2; i < 6; i++) {         
                    picturesHTML += '<div class="column"> <div class="image-holder">  <a href="">  <div class="image" style="background-image:url('  + 'panel/assets/images/recipe-' + recipe['uid'] + '-image' + i + '.jpeg' +  ')"></div>  </a></div> </div>';                         
                }
                pictures.innerHTML = picturesHTML;     
                
                
                                
            }
        };

        xhttp.open("GET", "api/service.php?action=get_recipe&uid=" + uid, true);
        xhttp.send();
    }


   
</script>
</html>